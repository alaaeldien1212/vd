(()=>{var e={};e.id=36,e.ids=[36],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2615:e=>{"use strict";e.exports=require("http")},8791:e=>{"use strict";e.exports=require("https")},8621:e=>{"use strict";e.exports=require("punycode")},6162:e=>{"use strict";e.exports=require("stream")},7360:e=>{"use strict";e.exports=require("url")},1568:e=>{"use strict";e.exports=require("zlib")},1069:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>c,routeModule:()=>h,tree:()=>o}),s(3976),s(2222),s(5866);var r=s(3191),a=s(8716),i=s(7922),n=s.n(i),l=s(5231),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);s.d(t,d);let o=["",{children:["vendor",{children:["[token]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,3976)),"/Users/staynza/Desktop/Vnd/app/vendor/[token]/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,2222)),"/Users/staynza/Desktop/Vnd/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/staynza/Desktop/Vnd/app/vendor/[token]/page.tsx"],m="/vendor/[token]/page",x={require:s,loadChunk:()=>Promise.resolve()},h=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/vendor/[token]/page",pathname:"/vendor/[token]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},5064:(e,t,s)=>{Promise.resolve().then(s.bind(s,2467))},8537:(e,t,s)=>{Promise.resolve().then(s.bind(s,7553))},5296:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},2467:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m});var r=s(326),a=s(7577),i=s(5047),n=s(5442),l=s(7202),d=s(7358),o=s(6283),c=s(3685);function m(){let e=(0,i.useParams)().token,[t,s]=(0,a.useState)(null),[m,x]=(0,a.useState)([]),[h,p]=(0,a.useState)([]),[u,g]=(0,a.useState)(!0),[j,y]=(0,a.useState)(null),[b,v]=(0,a.useState)(null),[f,N]=(0,a.useState)(!1),[w,_]=(0,a.useState)(!1),[k,P]=(0,a.useState)({}),[S,Z]=(0,a.useState)({}),I=async()=>{try{g(!0);let t=atob(e);console.log("Decoded token:",t);let r=t.split("_")[1];console.log("Project ID:",r);let{data:a,error:i}=await n.O.from("project_overview").select("*").eq("id",r).single();if(i)throw i;s(a);let{data:l,error:d}=await n.O.from("milestones").select(`
          id,
          name,
          description,
          due_date,
          status,
          completion_percentage,
          weight_percentage,
          evidence_required,
          vendor_notes,
          rejection_reason,
          milestone_evidence(count)
        `).eq("project_id",r).order("due_date",{ascending:!0});if(d)throw d;let o=(l||[]).map(e=>({...e,evidence_count:e.milestone_evidence?.[0]?.count||0}));x(o);let c={};o.forEach(e=>{c[e.id]=e.vendor_notes||""}),P(c)}catch(e){console.error("Error fetching project data:",e),y(e instanceof Error?e.message:"An error occurred")}finally{g(!1)}},q=(e,t)=>{Z(s=>{let r=s[e]||[];return{...s,[e]:[...r,t]}})},D=(e,t)=>{Z(s=>{let r=(s[e]||[]).slice();return r.splice(t,1),{...s,[e]:r}})},M=async(e,t)=>{try{let{error:s}=await n.O.from("milestones").update({vendor_notes:t}).eq("id",e);if(s)throw s;P(s=>({...s,[e]:t}))}catch(e){console.error("Error updating notes:",e)}},E=async e=>{try{for(let t of(_(!0),S[e]||[])){let s=t.name.split(".").pop(),r=`${e}_${Date.now()}.${s}`,{error:a}=await n.O.storage.from("evidence-files").upload(r,t);if(a)throw a;let{error:i}=await n.O.from("milestone_evidence").insert({milestone_id:e,file_name:t.name,file_path:r,file_type:t.type,file_size:t.size,description:"",uploaded_by:"5cb0ddab-5f60-45b9-a2d8-5b2770e68b1e"});if(i)throw i}Z(t=>({...t,[e]:[]}));let{error:t}=await n.O.from("milestones").update({status:"pending_completion_review",completion_percentage:100,rejection_reason:null}).eq("id",e);if(t)throw t;await I(),alert("Milestone submitted for review successfully!")}catch(e){console.error("Error submitting milestone:",e),alert("Failed to submit milestone. Please try again.")}finally{_(!1)}};return u?r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600 mx-auto"}),r.jsx("p",{className:"mt-4 text-gray-600",children:"Loading vendor portal..."})]})}):t?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[r.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:r.jsx("div",{className:"px-6 py-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Vendor Portal"}),r.jsx("p",{className:"text-gray-600 mt-1",children:t.name})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsxs)("div",{className:"text-right",children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Client"}),r.jsx("p",{className:"font-medium text-gray-900",children:t.client_name})]}),(0,r.jsxs)("div",{className:"text-right",children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Project Manager"}),r.jsx("p",{className:"font-medium text-gray-900",children:t.project_manager_name})]})]})]})})}),(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200 mb-6",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Project Information"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Description"}),r.jsx("p",{className:"text-gray-900",children:t.description})]}),(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Start Date"}),r.jsx("p",{className:"text-gray-900",children:new Date(t.start_date).toLocaleDateString()})]}),(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"End Date"}),r.jsx("p",{className:"text-gray-900",children:new Date(t.end_date).toLocaleDateString()})]})]})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Project Milestones"}),m.map(e=>r.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[r.jsx("h4",{className:"text-lg font-medium text-gray-900",children:e.name}),r.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${"completed"===e.status?"bg-green-100 text-green-800":"approved"===e.status?"bg-green-100 text-green-800":"pending_completion_review"===e.status?"bg-yellow-100 text-yellow-800":"in_progress"===e.status?"bg-blue-100 text-blue-800":"overdue"===e.status?"bg-red-100 text-red-800":"rejected"===e.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:e.status})]}),r.jsx("p",{className:"text-gray-600 mt-1",children:e.description}),"rejected"===e.status&&e.rejection_reason&&r.jsx("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded-lg",children:(0,r.jsxs)("div",{className:"flex items-start",children:[r.jsx(l.Z,{className:"h-4 w-4 text-red-500 mt-0.5 mr-2 flex-shrink-0"}),(0,r.jsxs)("div",{children:[r.jsx("h6",{className:"text-sm font-medium text-red-800",children:"Rejection Reason:"}),r.jsx("p",{className:"text-sm text-red-700 mt-1",children:e.rejection_reason})]})]})}),(0,r.jsxs)("div",{className:"mt-3 flex items-center space-x-6",children:[(0,r.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[r.jsx(d.Z,{className:"h-4 w-4 mr-1"}),"Due: ",new Date(e.due_date).toLocaleDateString()]}),(0,r.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[r.jsx(o.Z,{className:"h-4 w-4 mr-1"}),"Evidence: ",e.evidence_count," files"]})]})]}),(0,r.jsxs)("div",{className:"ml-4",children:[r.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:r.jsx("div",{className:"bg-primary-600 h-2 rounded-full",style:{width:`${e.completion_percentage}%`}})}),(0,r.jsxs)("p",{className:"text-sm text-gray-500 mt-1 text-center",children:[e.completion_percentage,"%"]})]})]}),(0,r.jsxs)("div",{className:"mt-6 border-t border-gray-200 pt-6",children:[r.jsx("h5",{className:"text-sm font-medium text-gray-900 mb-3",children:"approved"===e.status?"View Evidence":"Upload Evidence"}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:["approved"===e.status?(0,r.jsxs)("div",{className:"flex items-center px-4 py-2 border border-gray-300 rounded-lg bg-gray-50",children:[r.jsx(o.Z,{className:"h-4 w-4 mr-2"}),"View Evidence Files"]}):(0,r.jsxs)("label",{className:"cursor-pointer",children:[r.jsx("input",{type:"file",className:"hidden",onChange:t=>{let s=t.target.files?.[0];s&&q(e.id,s)},disabled:f}),(0,r.jsxs)("div",{className:"flex items-center px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:[r.jsx(c.Z,{className:"h-4 w-4 mr-2"}),f?"Uploading...":"Choose File"]})]}),"approved"!==e.status&&r.jsx("div",{className:"text-sm text-gray-700",children:S[e.id]&&S[e.id].length>0?(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-gray-600 mb-1",children:"Files to be submitted:"}),r.jsx("ul",{className:"list-disc list-inside space-y-1",children:S[e.id].map((t,s)=>(0,r.jsxs)("li",{className:"flex items-center justify-between",children:[r.jsx("span",{children:t.name}),r.jsx("button",{onClick:()=>D(e.id,s),className:"text-xs text-red-600 hover:underline",children:"remove"})]},s))})]}):r.jsx("span",{className:"text-sm text-gray-500",children:"Upload documents, photos, or other evidence"})})]})]}),(0,r.jsxs)("div",{className:"mt-6 border-t border-gray-200 pt-6",children:[r.jsx("h5",{className:"text-sm font-medium text-gray-900 mb-3",children:"Your Notes"}),r.jsx("textarea",{value:k[e.id]||"",onChange:t=>P(s=>({...s,[e.id]:t.target.value})),onBlur:()=>M(e.id,k[e.id]||""),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",rows:3,placeholder:"Add your notes, comments, or updates about this milestone..."})]}),("not_started"===e.status||"in_progress"===e.status||"rejected"===e.status)&&r.jsx("div",{className:"mt-6 border-t border-gray-200 pt-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[r.jsx("h5",{className:"text-sm font-medium text-gray-900",children:"rejected"===e.status?"Resubmit for Review?":"Ready to Submit?"}),r.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"rejected"===e.status?"Address the feedback above and resubmit your evidence for review.":"Upload your evidence and submit for review when ready."})]}),r.jsx("button",{onClick:()=>E(e.id),disabled:w,className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:w?(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Submitting..."]}):"rejected"===e.status?"Resubmit for Review":"Submit for Review"})]})})]})},e.id))]}),0===m.length&&(0,r.jsxs)("div",{className:"text-center py-12",children:[r.jsx(o.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Milestones Yet"}),r.jsx("p",{className:"text-gray-600",children:"Milestones will appear here once they are created by the project manager."})]})]})]}):r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Invalid Access"}),r.jsx("p",{className:"text-gray-600",children:"The vendor portal link is invalid or expired."})]})})}},7553:(e,t,s)=>{"use strict";s.d(t,{default:()=>h});var r=s(326),a=s(434),i=s(5047),n=s(5920),l=s(9734),d=s(4061),o=s(6283),c=s(6464),m=s(8378);let x=[{name:"Dashboard",href:"/",icon:n.Z},{name:"Projects",href:"/projects",icon:l.Z},{name:"Vendor Portal",href:"/vendor",icon:d.Z},{name:"Purchase Orders",href:"/purchase-orders",icon:o.Z},{name:"Analytics",href:"/analytics",icon:c.Z},{name:"Settings",href:"/settings",icon:m.Z}];function h(){let e=(0,i.usePathname)();return(0,r.jsxs)("nav",{className:"bg-white shadow-sm border-r border-gray-200 w-64 min-h-screen",children:[r.jsx("div",{className:"p-6",children:(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx("div",{className:"w-8 h-8 bg-primary-600 rounded-lg flex items-center justify-center",children:r.jsx("span",{className:"text-white font-bold text-sm",children:"MT"})})}),(0,r.jsxs)("div",{className:"ml-3",children:[r.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Milestone Tracker"}),r.jsx("p",{className:"text-xs text-gray-500",children:"SaaS Platform"})]})]})}),r.jsx("div",{className:"px-3 pb-3",children:r.jsx("div",{className:"space-y-1",children:x.map(t=>{let s=e===t.href;return(0,r.jsxs)(a.default,{href:t.href,className:`group flex items-center px-3 py-2 text-sm font-medium rounded-lg transition-colors duration-200 ${s?"bg-primary-50 text-primary-700 border-r-2 border-primary-600":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"}`,children:[r.jsx(t.icon,{className:`mr-3 h-5 w-5 ${s?"text-primary-600":"text-gray-400 group-hover:text-gray-500"}`}),t.name]},t.name)})})})]})}},5442:(e,t,s)=>{"use strict";s.d(t,{O:()=>r});let r=(0,s(7939).eI)("https://gbnmunfdgdnvlzcabyxf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdibm11bmZkZ2Rudmx6Y2FieXhmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTczOTg5OTIsImV4cCI6MjA3Mjk3NDk5Mn0.dW5qalrprjBpW-A1SjKQ72dU-99JErIawkOuqHnVSBI")},7202:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(6557).Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},7358:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(6557).Z)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},3685:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(6557).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},2222:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d,metadata:()=>l});var r=s(9510),a=s(5384),i=s.n(a);s(7272);let n=(0,s(8570).createProxy)(String.raw`/Users/staynza/Desktop/Vnd/components/Navigation.tsx#default`),l={title:"Milestone Tracker - Procurement & Construction SaaS",description:"Centralized milestone tracking for procurement and construction projects"};function d({children:e}){return r.jsx("html",{lang:"en",children:r.jsx("body",{className:i().className,children:(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50 flex",children:[r.jsx(n,{}),r.jsx("div",{className:"flex-1",children:e})]})})})}},3976:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(8570).createProxy)(String.raw`/Users/staynza/Desktop/Vnd/app/vendor/[token]/page.tsx#default`)},7272:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[773,939],()=>s(1069));module.exports=r})();